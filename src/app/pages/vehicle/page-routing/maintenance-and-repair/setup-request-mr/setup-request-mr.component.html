
<div class="p-2" style="background-color: #f3f3f3">
    
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div nz-col nzSpan="14" *ngIf="id">
            <button type="button" (click)="onBack($event); " class="flex" style="margin-bottom: 10px;">
                <span class="mx-2 " style="margin-top: 3px ; cursor: pointer;">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.825 9L9.425 14.6L8 16L0 8L8 0L9.425 1.4L3.825 7H16V9H3.825Z" fill="#274EA1" />
                    </svg>
                </span>
                <span>
                    Quay lại
                </span>
            </button>
            </div>
        <span *ngIf="!id">Thiết lập yêu cầu bảo dưỡng sửa chữa</span>
        <span *ngIf="id">Thông tin xe BDSC</span>

    <div style="background-color: #ffffff; border-radius: 12px">
      <div nz-row>
        <div style="width: 50%">
          <div class="p-4 pb-0 form-container">
            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.router" | translate
                }}</label>
                <nz-select
                  nzPlaceHolder="Chọn"
                  formControlName="routeId"
                  style="width: 100%"
                >
                  <nz-option
                    *ngFor="let data of listRoute"
                    [nzValue]="data.id"
                    [nzLabel]="data.name"
                  ></nz-option>
                </nz-select>
                <div class="error-container">
                  <div
                    *ngIf="
                      (form.get('routeId')?.invalid &&
                        form.get('routeId')?.dirty) ||
                      form.get('routeId')?.touched
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('routeId')?.hasError('required')"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.registerNo" | translate
                }}</label>
                <nz-select
                  nzPlaceHolder="Chọn"
                  class="nzSelect"
                  formControlName="registerNo"
                >
                  <nz-option
                    *ngFor="let data of listForMaintenance"
                    [nzValue]="data.registerNo"
                    [nzLabel]="data.registerNo"
                  ></nz-option>
                </nz-select>
                <div class="error-container">
                  <div
                    *ngIf="
                      (form.get('registerNo')?.invalid &&
                        form.get('registerNo')?.dirty) ||
                      form.get('registerNo')?.touched
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('registerNo')?.hasError('required')"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "table.vehicle.driver" | translate
                }}</label>
                <input
                  class="input-form"
                  placeholder="Nhập"
                  type="text"
                  formControlName="driver"
                />
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('driver')?.invalid &&
                      (form.get('driver')?.dirty || form.get('driver')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('driver')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.vehiclePhone" | translate
                }}</label>
                <input
                  class="input-form"
                  placeholder="0896641257"
                  type="text"
                  formControlName="phoneNumber"
                />
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('phoneNumber')?.invalid &&
                      (form.get('phoneNumber')?.dirty ||
                        form.get('phoneNumber')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('phoneNumber')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

                        <div class="input-wrapper">
                            <div class="">
                                <label class="label-form" for="" >{{'vehicle.latestOdometer' | translate}}</label>
                                <input class="input-form"  placeholder="Nhập" type="number" min="0" formControlName="latestOdometer" >
                                <div class="error-container">
                                    <!-- <div *ngIf="form.get('latestOdometer')?.invalid && (form.get('latestOdometer')?.dirty || form.get('latestOdometer')?.touched)">
                                        <span class="validate_input" *ngIf="form.get('latestOdometer')?.errors?.['required']">{{'required.cannotBlank' | translate}}</span>
                                    </div> -->
                                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <label class="label-form">
                  {{ "vehicle.latestDate" | translate }}
                </label>
                <nz-date-picker
                  nzFormat="dd/MM/yyyy"
                  formControlName="latestDate"
                  class="w-full"
                  style="width: 100%"
                  nzPlaceHolder="{{ 'Chọn ngày' | translate }}"
                ></nz-date-picker>
                <div class="error-container">
                                        <!-- <div *ngIf="form.get('latestDate')?.invalid && (form.get('latestDate')?.dirty) || form.get('latestDate')?.touched">
                                            <span class="validate_input" *ngIf="form.get('latestDate')?.errors?.['required']">{{'required.cannotBlank' | translate}}</span>
                                        </div> -->
                                    </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.currentOdometer" | translate
                }}</label>
                <input
                  class="input-form"
                  placeholder="Nhập"
                  type="number" min="0"
                  formControlName="currentOdometer"
                />
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('currentOdometer')?.invalid &&
                      (form.get('currentOdometer')?.dirty ||
                        form.get('currentOdometer')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('currentOdometer')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.levelMaintenance" | translate
                }}</label>
                <nz-select
                  nzPlaceHolder="Chọn"
                  class="nzSelect"
                  formControlName="levelMaintenance"
                >
                  <nz-option
                    nzValue="1"
                    nzLabel="Bảo dưỡng định kỳ"
                  ></nz-option>
                  <nz-option
                    nzValue="2"
                    nzLabel="Bảo dưỡng không định kỳ"
                  ></nz-option>
                </nz-select>
                <div class="error-container">
                  <div
                    *ngIf="
                      (form.get('levelMaintenance')?.invalid &&
                        form.get('levelMaintenance')?.dirty) ||
                      form.get('levelMaintenance')?.touched
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('levelMaintenance')?.hasError('required')"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.supposedStartTime" | translate
                }}</label>
                <nz-time-picker
                  formControlName="supposedStartTime"
                  style="height: 48px !important; width: 100%"
                  nzFormat="HH:mm"
                ></nz-time-picker>
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('supposedStartTime')?.invalid &&
                      (form.get('supposedStartTime')?.dirty ||
                        form.get('supposedStartTime')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('supposedStartTime')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.supposedStartDate" | translate
                }}</label>
                <nz-date-picker
                  class="w-full"
                  style="height: 48px !important"
                  [nzDisabledDate]="disableAfterDate('supposedEndDate')"
                  nzFormat="dd/MM/yyyy"
                  formControlName="supposedStartDate"
                  nzPlaceHolder="Chọn ngày"
                ></nz-date-picker>
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('supposedStartDate')?.invalid &&
                      (form.get('supposedStartDate')?.dirty ||
                        form.get('supposedStartDate')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('supposedStartDate')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.supposedEndTime" | translate
                }}</label>
                <nz-time-picker
                  formControlName="supposedEndTime"
                  style="height: 48px !important; width: 100%"
                  nzFormat="HH:mm"
                ></nz-time-picker>

                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('supposedEndTime')?.invalid &&
                      (form.get('supposedEndTime')?.dirty ||
                        form.get('supposedEndTime')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('supposedEndTime')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.supposedEndDate" | translate
                }}</label>
                <nz-date-picker
                  class="w-full"
                  [nzDisabledDate]="disableBeforeDate('supposedStartDate')"
                  style="height: 48px !important"
                  nzFormat="dd/MM/yyyy"
                  formControlName="supposedEndDate"
                  nzPlaceHolder="Chọn ngày"
                ></nz-date-picker>
                <div class="error-container">
                  <div
                    *ngIf="
                      form.get('supposedEndDate')?.invalid &&
                      (form.get('supposedEndDate')?.dirty ||
                        form.get('supposedEndDate')?.touched)
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('supposedEndDate')?.errors?.['required']"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper">
              <div class="">
                <span style="color: red">*</span
                ><label class="label-form" for="">{{
                  "vehicle.maintenancePlace" | translate
                }}</label>
                <nz-select
                  nzPlaceHolder="Chọn"
                  class="nzSelect"
                  formControlName="maintenancePlace"
                  style="height: 48px !important"
                >
                  <nz-option
                    *ngFor="let data of listMaintenanceFacilities"
                    [nzValue]="data.value"
                    [nzLabel]="data.value"
                  ></nz-option>
                </nz-select>
                <div class="error-container">
                  <div
                    *ngIf="
                      (form.get('maintenancePlace')?.invalid &&
                        form.get('maintenancePlace')?.dirty) ||
                      form.get('maintenancePlace')?.touched
                    "
                  >
                    <span
                      class="validate_input"
                      *ngIf="form.get('maintenancePlace')?.hasError('required')"
                      >{{ "required.cannotBlank" | translate }}</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="input-wrapper2">
              <div class="">
                <label class="label-form" for="">{{
                  "vehicle.another" | translate
                }}</label>
                <input
                  class="input-form"
                  placeholder="Nhập"
                  type="text"
                  formControlName="note"
                />
                <!-- <div class="error-container">
                                    <div *ngIf="form.get('note')?.invalid && (form.get('note')?.dirty || form.get('note')?.touched)">
                                        <span class="validate_input" *ngIf="form.get('note')?.errors?.['required']">{{'required.note' | translate}}</span>
                                    </div>
                                </div> -->
              </div>
            </div>
          </div>
          <div nz-row>
            <div class="flex" style="padding-left: 36px; gap: 8px">
              <input
                style="width: 24px; height: 24px"
                type="checkbox"
                [checked]="priorityStatus === 1"
                formControlName="priorityStatus"
                name=""
                id=""
                (change)="onCheckboxChange($event)"
              />
              <span
                style="
                  color: rgba(37, 44, 50, 1);
                  size: 16px;
                  font-weight: 500;
                  font-size: 16px;
                "
                >{{ "vehicle.priority" | translate }}</span
              >
            </div>
          </div>
        </div>
        <div style="width: 50%" *ngIf="!isFromRequestMr">
          <div class="p-4 pb-0">
            <span>{{ "vehicle.listVehicalRepair" | translate }} </span>
            <table class="custom-table-list" style="background-color: #fcfcfc">
              <tbody>
                <tr style="background-color: #fcfcfc">
                  <th class="list-col-1">{{ "table.stt" | translate }}</th>
                  <th class="list-col-2">
                    {{ "table.vehicle.licensePlate" | translate }}
                  </th>
                  <th class="list-col-3">
                    {{ "table.vehicle.driver" | translate }}
                  </th>
                  <th class="list-col-2">
                    {{ "table.phoneNumber" | translate }}
                  </th>
                  <th class="list-col-2">
                    {{ "table.vehicle.maintenanceKm" | translate }}
                  </th>
                  <th class="list-col-2">{{ "table.action" | translate }}</th>
                </tr>
                <tr
                  *ngFor="let data of showNoDataForMaintenance(); let i = index"
                >
                  <td class="list-col-1">
                    {{ (pageIndex - 1) * pageSize + i + 1 }}
                  </td>
                  <td class="list-col-2">{{ data.registerNo || "-" }}</td>
                  <td class="list-col-3">{{ data.driverName || "-" }}</td>
                  <td class="list-col-2">{{ data.phoneNumber || "-" }}</td>
                  <td class="list-col-2">
                    {{ data.maintenanceOdometer || "-" }}
                  </td>

                  <td
                    class="button_action list-col-2"
                    style="text-align: center"
                  >
                    <div>
                      <a
                        *ngIf="data.id"
                        class="mx-1 button_show_detail"
                        (click)="onSelectRow(data)"
                      >
                        Chọn
                      </a>
                      <span *ngIf="!data.id">-</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div style="display: flex; justify-content: center">
            <nz-pagination
              [(nzPageIndex)]="pageIndex"
              [nzTotal]="total"
              [nzPageSize]="pageSize"
              (nzPageIndexChange)="onPageChange($event)"
              class="custom-pagination"
            >
            </nz-pagination>
          </div>
        </div>
      </div>
      <div style="background-color: #ffffff">
        <div class="p-4">
          <nz-tabset>
            <nz-tab nzTitle="{{ 'vehicle.vehicleStatus' | translate }}">
              <app-car-status
                [parentData]="listVS"
                (dataEmitter)="receiveData($event, 'vehicleStatus')"
                [isFromRequestMr]="isFromRequestMr"
              ></app-car-status>
            </nz-tab>
            <nz-tab nzTitle="{{ 'vehicle.itemCheck' | translate }}">
              <app-item-check
                [parentData]="lstTC"
                (dataEmitter)="receiveData($event, 'testItem')"
              ></app-item-check>
            </nz-tab>
            <nz-tab nzTitle="{{ 'vehicle.workPerformed' | translate }}">
              <app-work-performed
                [parentData]="listWP"
                (dataEmitter)="receiveData($event, 'workPerformed')"
              ></app-work-performed>
            </nz-tab>
            <nz-tab nzTitle="{{ 'vehicle.replacementSupplies' | translate }}">
              <app-replacement-supplies
                [parentData]="lstRS"
                (dataEmitter)="receiveData($event, 'replacementSupplies')"
              ></app-replacement-supplies>
            </nz-tab>
          </nz-tabset>
        </div>
      </div>
    </div>
    <div class="ml-1 flex justify-end" style="gap: 12px">
      <span *ngIf="id">
        <button
          type="button"
          (click)="cancelFix()"
          class="button-infor"
          nz-button
          style="color: #274ea1; border-color: #274ea1"
          nzType="default"
        >
          Hủy
        </button>
      </span>
      <span>
        <button
          type="submit"
          class="button-infor"
          style="background-color: #274ea1; color: white"
          nz-button
          nzType="default"
        >
          {{ !id ? "Hoàn tất" : "Lưu" }}
        </button>
      </span>
    </div>
  </form>
</div>

